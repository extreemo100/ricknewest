
<script>

    function getOS() {

            if (navigator.platform.toUpperCase().indexOf('MAC') >= 0) {
                return 'MACOS'
            }

        if (navigator.platform.toUpperCase().indexOf('IPHONE') >= 0 ||
            navigator.platform.toUpperCase().indexOf('IPAD') >= 0 ||
            navigator.platform.toUpperCase().indexOf('IPOD') >= 0) {
            return 'IOS'
        }

        if (navigator.platform.toUpperCase().indexOf('WIN') >= 0) {
            return 'WINDOWS'
        }

        if (/android/i.test(navigator.userAgent)) {
            return 'ANDROID';
        }

        return "UNKNOWN"
    }


    function checkLimits(visitLimit, visitCounter, lifetimeLimit, createdAt) {

    if (visitLimit !== null && visitCounter !== null && visitCounter >= visitLimit && visitLimit !== 0) {
        const limitExceededMsg = document.createElement('div');
        limitExceededMsg.classList.add('limit-exceeded');
        limitExceededMsg.textContent = 'Visit limit exceeded.\nRedirecting to main site soon.';
        document.body.appendChild(limitExceededMsg);
        setTimeout(() => {
            window.location.href = window.location.origin;
        }, 15000);
    } else{
        const createdAtDate = new Date(createdAt);
        const lifetimeLimitSeconds = lifetimeLimit !== null && lifetimeLimit !== 0 ? lifetimeLimit : Infinity;
        const lifetimeSeconds = (Date.now() - createdAtDate.getTime()) / 1000;
        if (lifetimeSeconds > lifetimeLimitSeconds) {
        const itemExpiredMsg = document.createElement('div');
        itemExpiredMsg.classList.add('item-expired');
        itemExpiredMsg.textContent = 'Item expired.\nRedirecting to main site soon.';
        document.body.appendChild(itemExpiredMsg);
        setTimeout(() => {
            window.location.href = window.location.origin;
        }, 15000);
    }
    }
    

    


}
</script>
<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="../css/show.css">
    <script src="https://xdsmgyjuwrsmlvtwsjyu.supabase.co/storage/v1/object/public/Mind%20Bucket/mindar-image.prod.js?t=2023-10-09T11%3A46%3A46.856Z"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://xdsmgyjuwrsmlvtwsjyu.supabase.co/storage/v1/object/public/Mind%20Bucket/mindar-image-aframe.prod.js?t=2023-10-09T11%3A47%3A18.307Z"></script>
    <script>

        document.addEventListener("DOMContentLoaded", function () {

            checkLimits(20, 0, 604800, '2023-09-15T10:33:43.658Z');

            const sceneEl = document.querySelector('a-scene');
            const arSystem = sceneEl.systems["mindar-image-system"];

            const video = document.querySelector("#video");
            const unmuteButton = document.querySelector("#unmuteButton");

            var viewerOs = getOS();
            if (viewerOs == "ANDROID" || viewerOs == "WINDOWS") {
                unmuteButton.style.display = "none";
            }

            unmuteButton.addEventListener("click", function () {
                video.muted = false;
                unmuteButton.style.display = "none";
            });

            AFRAME.registerComponent('target_01', {
                init: function () {
                    this.el.addEventListener('targetFound', event => {
                        document.querySelector("#video-view").setAttribute("src", "#video");
                        document.querySelector("#video").play();
                        if (viewerOs == "ANDROID" || viewerOs == "WINDOWS") {
                            video.muted = false;
                        }
                    });
                    this.el.addEventListener('targetLost', event => {
                        document.querySelector("#video-view").setAttribute("src", "#video");
                        document.querySelector("#video").pause();
                        if (viewerOs == "ANDROID" || viewerOs == "WINDOWS") {
                            video.muted = true;
                        }
                    });
                }
            });

            var video_redirectUrl = ""

            if (video_redirectUrl !== "" && video_redirectUrl.startsWith("https://")) {
                console.log("to redirect to: " + video_redirectUrl)
                const video = document.querySelector('#video')
                video.addEventListener('ended', videoHandler, false);
                function videoHandler(e) {
                    window.location.href = video_redirectUrl;
                }
            };

            const customLinksContainer = document.getElementById("customLinksButtons");

            
            

            let imgBtnCount = 0;
            
            

            if (imgBtnCount > 0) {
                const customBottomImageButtonsContainer = document.getElementById("customBottomImageButtons");
                const buttonWidth = `${100 / imgBtnCount}%`;
                
                
                
            }

        }
        )
    </script>

</head>

<body>

    <div id="example-scanning-overlay" class="hidden">
        <div class="inner">
      <img src="imageTargetSrc: https://xdsmgyjuwrsmlvtwsjyu.supabase.co/storage/v1/object/public/Mind%20Bucket/rick.mind?t=2023-10-13T08%3A11%3A48.325Z"/>
      <div class="scanline"></div>
        </div>
      </div>

    <a-scene mindar-image='uiScanning: #example-scanning-overlay; imageTargetSrc: https://xdsmgyjuwrsmlvtwsjyu.supabase.co/storage/v1/object/public/Mind%20Bucket/rick.mind?t=2023-10-13T08%3A11%3A48.325Z; 
        filterMinCF:0.0001; 
        filterBeta: 0.005; 
        warmupTolerance: 1; 
        missTolerance: 10' color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false" crossorigin="anonymous">
        <a-assets>
            <video id="video"
                autoplay="true"
                loop="true"
                src="https://res.cloudinary.com/dzq7c0mxt/video/upload/v1697181924/videos/Rick_hnfo4o.mp4"  playsinline muted 
                preload="metadata" crossorigin="anonymous">
        </a-assets>

        <a-entity id="target_01" target_01 mindar-image-target="targetIndex: 0">
            <a-video id="video-view"
                width="1"
                height="0.53125"
                position="0 0 0"
                webkit-playsinline playsinline 
                crossorigin="anonymous" >
            </a-video>

        </a-entity>

        <a-camera position="0 0 0"
            look-controls="enabled: false">
        </a-camera>

    </a-scene>


    <div id="customLinksButtons" class="custom-button-show"></div>

    <div id="customBottomImageButtonsContainer" class="custom-bottom-button-container">
        <div id="customBottomImageButtons" class="custom-bottom-image-buttons"></div>
    </div>
    

    <div id="unmuteButtonContainer">
        <button id="unmuteButton" class="mute-button">Tap to UNMUTE ðŸ”Š</button>
    </div>
    

</body>

</html>